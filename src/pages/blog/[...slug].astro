---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Heading from '@components/ui/heading.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const shareUrl = new URL(Astro.url.pathname, Astro.site).toString();
const shareText = `Lee "${post.data.title}" en el blog de Ashlee Arrieta Lavado`;

const shareLinks = [
  {
    name: 'Twitter',
    url: `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`,
    icon: '/social/twitter.svg'
  },
  {
    name: 'Facebook',
    url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`,
    icon: '/social/facebook.svg'
  },
  {
    name: 'LinkedIn',
    url: `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent(post.data.title)}`,
    icon: '/social/linkedin.svg'
  },
  {
    name: 'WhatsApp',
    url: `https://wa.me/?text=${encodeURIComponent(`${shareText} ${shareUrl}`)}`,
    icon: '/social/whatsapp.svg'
  }
];
---

<Layout>
  <article class="max-w-[800px] mx-auto px-l py-xxxl">
    <header class="mb-xl">
      {post.data.thumbnail && (
        <img
          src={post.data.thumbnail.src}
          alt=""
          class="w-full h-[300px] object-cover rounded-default mb-l"
        />
      )}
      <Heading as="h1" variant="h2">
        {post.data.title}
      </Heading>
      <time 
        datetime={post.data.date.toISOString()}
        class="text-neutral07 block mt-4"
      >
        {new Date(post.data.date).toLocaleDateString('es-ES', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        })}
      </time>
    </header>

    <div class="prose">
      <Content />
    </div>

    <footer class="mt-xl pt-l border-t border-neutral03">
      <div class="flex flex-col items-center gap-s">
        <p class="text-neutral07">Comparte este artículo</p>
        <ul class="flex gap-s">
          {shareLinks.map(link => (
            <li>
              <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                class="block p-s hover:bg-neutral02 rounded-default transition-colors"
                aria-label={`Compartir en ${link.name}`}
              >
                <img src={link.icon} alt="" width="24" height="24" />
              </a>
            </li>
          ))}
        </ul>
      </div>

      <nav class="mt-xl">
        <a href="/blog" class="text-action05 hover:underline">← Volver al blog</a>
      </nav>
    </footer>
  </article>
</Layout>

<style>
  .prose {
    max-width: 100%;
    color: theme(colors.main09);
  }
  .prose :global(p) {
    margin-bottom: 1.5em;
    line-height: 1.75;
  }
  .prose :global(h2) {
    font-size: 1.5em;
    margin-top: 2em;
    margin-bottom: 1em;
    font-weight: 700;
  }
  .prose :global(h3) {
    font-size: 1.25em;
    margin-top: 1.6em;
    margin-bottom: 0.6em;
    font-weight: 700;
  }
  .prose :global(ul) {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
    padding-left: 1.625em;
    list-style-type: disc;
  }
  .prose :global(ol) {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
    padding-left: 1.625em;
    list-style-type: decimal;
  }
  .prose :global(li) {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
  .prose :global(a) {
    color: theme(colors.action05);
    text-decoration: underline;
  }
  .prose :global(blockquote) {
    margin-top: 1.6em;
    margin-bottom: 1.6em;
    padding-left: 1em;
    border-left: 0.25em solid theme(colors.neutral04);
    font-style: italic;
  }
</style>